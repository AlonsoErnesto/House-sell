<section
  id="galeria"
  class="py-20 bg-white min-h-screen flex flex-col justify-center relative"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row justify-between items-start mb-12">
      <h2
        class="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight max-w-xl"
      >
        Descubra la propiedad perfecta para ti
      </h2>
      <p
        class="text-slate-500 text-lg max-w-md mt-6 md:mt-0 font-light leading-relaxed"
      >
        Descubra un lugar donde la comodidad se combina con el estilo,
        ofreciendo un entorno sereno, comodidades modernas y una comunidad
        vibrante perfecta para vivir.
      </p>
    </div>

    <!-- Video Container -->
    <div
      class="relative w-full h-125 md:h-[600px] rounded-3xl overflow-hidden shadow-2xl group cursor-pointer"
      id="video-container"
    >
      <video
        id="property-video"
        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
        muted
        loop
        playsinline
        preload="metadata"
        poster="/image1.png"
      >
        <source src="/videos/video1.mp4" type="video/mp4" />
        Tu navegador no soporta video HTML5.
      </video>
      <div
        class="absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors duration-300 pointer-events-none"
      >
      </div>

      <!-- Play Button (Centered & Pulsing) - Visual Indicator -->
      <div
        class="absolute inset-0 flex items-center justify-center z-20 pointer-events-none transition-opacity duration-300"
        id="play-indicator"
      >
        <div
          class="bg-white/90 text-emerald-600 rounded-full p-6 shadow-xl backdrop-blur-sm transition-transform transform group-hover:scale-110 relative animate-heartbeat"
        >
          <span
            class="absolute inset-0 rounded-full bg-white/40 animate-ping opacity-75"
          ></span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="w-12 h-12 relative z-10"
          >
            <path
              fill-rule="evenodd"
              d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
              clip-rule="evenodd"></path>
          </svg>
        </div>
      </div>

      <!-- Info Overlay (Top Right) -->
      <div class="absolute top-6 right-6 z-20 max-w-sm pointer-events-none">
        <div
          class="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl relative overflow-hidden transition-all duration-300"
        >
          <div class="flex flex-col gap-2">
            <div>
              <h3 class="text-3xl font-bold text-white mb-1">$130,000</h3>
              <p class="text-white/90 text-lg">Ciudad de Dios</p>
              <p class="text-white/80 text-sm">Km 16, Yura</p>
            </div>

            <div class="h-px bg-white/30 my-2"></div>

            <div
              class="flex items-center justify-between text-white/90 text-sm font-medium gap-4"
            >
              <div class="flex flex-col items-center">
                <span class="text-lg font-bold">200</span>
                <span class="text-xs opacity-75">m<sup>2</sup></span>
              </div>
              <div class="w-px h-8 bg-white/30"></div>
              <div class="flex flex-col items-center">
                <span class="text-lg font-bold">Agua</span>
                <span class="text-xs opacity-75">Servicio</span>
              </div>
              <div class="w-px h-8 bg-white/30"></div>
              <div class="flex flex-col items-center">
                <span class="text-lg font-bold">Luz</span>
                <span class="text-xs opacity-75">Servicio</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Expand Button (Bottom Right) -->
      <div class="absolute bottom-6 right-6 z-30">
        <button
          id="expand-btn"
          class="bg-black/50 hover:bg-black/70 text-white rounded-full p-3 backdrop-blur-md transition-all hover:scale-110"
          aria-label="Ver en pantalla completa"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-6 h-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Progress Bar -->
      <div class="absolute bottom-0 left-0 w-full h-1 bg-gray-800/50 z-20">
        <div
          id="progress-bar"
          class="h-full bg-emerald-500 transition-all duration-100 ease-linear w-0"
        >
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Video Modal -->
<dialog
  id="video_modal"
  class="modal modal-bottom sm:modal-middle bg-black/95 backdrop-blur-sm p-0 w-full h-full max-w-none max-h-none m-0"
>
  <div
    class="modal-box w-full h-full maximize max-w-none max-h-none p-0 bg-transparent flex items-center justify-center relative shadow-none border-none overflow-hidden rounded-none"
  >
    <button
      id="close-modal-btn"
      class="btn btn-circle btn-ghost absolute top-6 right-6 text-white bg-black/50 hover:bg-black/70 z-50 transform hover:scale-110 transition-all border-none"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-8 w-8"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path></svg
      >
    </button>
    <video id="modal-video" class="w-full h-full object-contain" controls>
      <source src="/videos/video1.mp4" type="video/mp4" />
    </video>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<script>
  const videoContainer = document.getElementById("video-container");
  const video = document.getElementById("property-video") as HTMLVideoElement;
  const playIndicator = document.getElementById("play-indicator");
  const progressBar = document.getElementById("progress-bar");
  const expandBtn = document.getElementById("expand-btn");

  const modal = document.getElementById("video_modal") as HTMLDialogElement;
  const modalVideo = document.getElementById("modal-video") as HTMLVideoElement;
  const closeModalBtn = document.getElementById("close-modal-btn");

  // Interaction Logic:
  // Desktop: Hover to play
  // Mobile: Scroll to play

  let isMobile = false;
  if (typeof window !== "undefined") {
    isMobile = window.matchMedia("(max-width: 768px)").matches;
  }

  // --- Playback Logic ---

  const playVideo = () => {
    video.play().catch(() => {
      // Auto-play might be blocked
    });
    playIndicator?.classList.add("opacity-0");
  };

  const pauseVideo = () => {
    video.pause();
    playIndicator?.classList.remove("opacity-0");
  };

  if (!isMobile) {
    // Desktop: Hover
    videoContainer?.addEventListener("mouseenter", playVideo);
    videoContainer?.addEventListener("mouseleave", pauseVideo);
  } else {
    // Mobile: Intersection Observer
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            playVideo();
          } else {
            pauseVideo();
          }
        });
      },
      { threshold: 0.5 },
    );

    if (videoContainer) observer.observe(videoContainer);
  }

  // --- Progress Bar ---
  video?.addEventListener("timeupdate", () => {
    const percentage = (video.currentTime / video.duration) * 100;
    if (progressBar) {
      progressBar.style.width = `${percentage}%`;
    }
  });

  // --- Modal Logic ---
  expandBtn?.addEventListener("click", (e) => {
    e.stopPropagation(); // Prevent container click if we add one later
    modal?.showModal();
    if (modalVideo) {
      modalVideo.currentTime = video.currentTime; // Sync time
      modalVideo.play();
      pauseVideo(); // Pause background video
    }
  });

  const closeVideo = () => {
    modal?.close();
    if (modalVideo) {
      modalVideo.pause();
    }
  };

  closeModalBtn?.addEventListener("click", closeVideo);

  modal?.addEventListener("close", () => {
    if (modalVideo) {
      modalVideo.pause();
    }
  });
</script>

<style>
  @keyframes heartbeat {
    0% {
      transform: scale(1);
    }
    14% {
      transform: scale(1.1);
    }
    28% {
      transform: scale(1);
    }
    42% {
      transform: scale(1.1);
    }
    70% {
      transform: scale(1);
    }
  }

  .animate-heartbeat {
    animation: heartbeat 2s infinite;
  }

  @keyframes bounce-in-up {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    60% {
      opacity: 1;
      transform: translateY(-5px);
    }
    100% {
      transform: translateY(0);
    }
  }

  section {
    animation: bounce-in-up 1s ease-out forwards;
  }
</style>
